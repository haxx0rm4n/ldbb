<!DOCTYPE html>
<html lang='en'>

<head>
  <title>Ludum Dare: Bare-bones</title>
  <style type="text/css">
    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: #FFE;
    }

    canvas {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translateX(-50%) translateY(-50%);

      box-shadow: 0 0 0 1px white, 0 0 0 16px darkred, -1px -1px 0 17px red, 1px 1px 0 17px #500, 0 16px 16px #222;
      outline: none;
      border-radius: 2px;
    }
  </style>
</head>
<body>
  <script defer src='/ldbb/src/autoloader.js'></script>
  <script defer>
    (function () {
      'use strict';

      window.addEventListener('load', function () {
        LDBB.DefaultLoader.Load('/ldbb/src', function () {
          var BackgroundState = (function () {
            function BackgroundState() {
              LDBB.State.State.apply(this, arguments);
              this.Priority = 0;
            }

            BackgroundState.prototype = Object.create(LDBB.State.State.prototype);
            BackgroundState.prototype.constructor = BackgroundState;

            BackgroundState.prototype.Tick = function (context) {

            };

            BackgroundState.prototype.Draw = function (context, canvas) {
              canvas.Fill("#888");
            };

            return BackgroundState;
          }());

          var PenState = (function () {
            function PenState() {
              LDBB.State.State.apply(this, arguments);
              this.Priority = 1;

              this._x = 150;
              this._y = 100;
            }

            PenState.prototype = Object.create(LDBB.State.State.prototype);
            PenState.prototype.constructor = PenState;

            PenState.prototype.Tick = function (context) {
              var input = context.Get("core.input");
              var states = context.Get("core.states");
              var assets = context.Get("core.assets");

              if (input.Check("L")) --this._x;
              if (input.Check("R")) ++this._x;
              if (input.Check("U")) --this._y;
              if (input.Check("D")) ++this._y;

              if (input.Check("Q", { single: true })) {
                assets.Assets["wav-powerUp"].Play();
                states.Toggle("bg");
              }
            };

            PenState.prototype.Draw = function (context, canvas) {
              var assets = context.Get("core.assets");

              canvas.Plot(this._x, this._y, "#222");
            };

            return PenState;
          }());

          window.game = new LDBB.Core.Game();
          game.SetSize(300, 200);
          game.ShouldLoadAsync(false);
          game.Init();
          game.Assets.Queue("img-gs", "sprite", "/ldbb/example/img/green-square.png");
          game.Assets.Queue("wav-powerUp", "sound", "/ldbb/example/wav/powerUp.wav");
          game.Assets.Queue("ldbb.core.img.logo", "sprite", "/ldbb/src/gfx/logo.png");
          game.Assets.Queue("ldbb.core.wav.loading-tone", "sound", "/ldbb/src/audio/loading-tone.wav");
          game.Input.Assign("L", ["kbd:KeyA"]);
          game.Input.Assign("R", ["kbd:KeyD"]);
          game.Input.Assign("U", ["kbd:KeyW"]);
          game.Input.Assign("D", ["kbd:KeyS"]);
          game.Input.Assign("Q", ["kbd:KeyQ"]);
          game.States.Add("ldbb.core.splash", new LDBB.State.SplashState("pen"));
          game.States.Add("bg", new BackgroundState());
          game.States.Add("pen", new PenState());
          game.States.Select("bg");
          game.States.Select("ldbb.core.splash");
          game.Start();

          document.body.appendChild(game.Canvas.Root);
          game.Canvas.Root.focus();
        });
      });
    }());
  </script>
</body>
</html>